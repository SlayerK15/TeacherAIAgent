<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AI Teacher Dashboard</title>
  <style>
    body { background: #f5f7fa; font-family: sans-serif; padding: 2em; }
    .container { max-width: 600px; margin: auto; background: #fff; border-radius: 12px; box-shadow: 0 2px 16px #0002; padding: 2em; }
    textarea, input[type=number] { width: 100%; font-size: 1em; border-radius: 6px; border: 1px solid #ccc; padding: 0.5em; margin-bottom: 1em;}
    button { padding: 0.6em 2em; font-size: 1em; border-radius: 6px; border: none; background: #4682f3; color: #fff; cursor: pointer; }
    button:disabled { background: #b0c7f5; cursor: not-allowed; }
    #status, #response { margin-top: 1.2em; }
    video { margin-top: 1.5em; width: 100%; border-radius: 12px; box-shadow: 0 2px 8px #0002; background: #000; }
    .label { font-weight: bold; margin-bottom: 0.3em; display: block; }
    .loader { border: 6px solid #f3f3f3; border-top: 6px solid #4682f3; border-radius: 50%; width: 32px; height: 32px; animation: spin 1s linear infinite; display: inline-block; vertical-align: middle;}
    @keyframes spin { 100% { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <div class="container">
    <h2>AI Teacher Dashboard</h2>
    <form id="teachForm" autocomplete="off">
      <label class="label" for="prompt">Ask a question or request a lesson:</label>
      <textarea id="prompt" required placeholder="E.g., Teach me about Newton's Laws"></textarea>
      <label class="label" for="videoLength">Total video length (minutes):</label>
      <input id="videoLength" type="number" min="4" max="120" value="8" required>
      <button type="submit" id="submitBtn">Submit</button>
    </form>
    <div id="status"></div>
    <div id="response"></div>
    <div id="videoContainer"></div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const teachForm = document.getElementById('teachForm');
      const promptInput = document.getElementById('prompt');
      const videoLengthInput = document.getElementById('videoLength');
      const statusDiv = document.getElementById('status');
      const responseDiv = document.getElementById('response');
      const videoContainer = document.getElementById('videoContainer');
      const submitBtn = document.getElementById('submitBtn');

      teachForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        console.log("FORM SUBMIT intercepted"); // DEBUG: You should see this in console every submit!
        if (submitBtn.disabled) return;

        statusDiv.innerHTML = '<span class="loader"></span> Generating lesson and video. This can take a few minutes...';
        videoContainer.innerHTML = '';
        responseDiv.innerHTML = '';
        submitBtn.disabled = true;

        const formData = new FormData();
        formData.append('user_prompt', promptInput.value);
        formData.append('video_minutes', videoLengthInput.value);

        try {
          const response = await fetch('http://localhost:8000/teach', {
            method: 'POST',
            body: formData
          });
          if (!response.ok) throw new Error("API error");
          const data = await response.json();

          responseDiv.innerHTML =
            `<b>Topic Tiers:</b> <pre>${JSON.stringify(data.topic_tiers, null, 2)}</pre>` +
            `<b>Simplified Steps:</b> <pre>${JSON.stringify(data.simplified_steps, null, 2)}</pre>` +
            `<b>Lessons:</b> <pre>${JSON.stringify(data.lessons, null, 2)}</pre>`;

          if (data.video_url) {
            const absUrl = data.video_url.startsWith('/')
              ? window.location.origin + data.video_url
              : data.video_url;
            videoContainer.innerHTML = `
              <video controls>
                <source src="${absUrl}" type="video/mp4">
                Your browser does not support the video tag.
              </video>
            `;
            statusDiv.textContent = '✅ Video lesson ready!';
          } else {
            statusDiv.textContent = 'No video generated.';
          }
        } catch (err) {
          statusDiv.textContent = '❌ An error occurred. Please try again.';
          console.error(err);
        } finally {
          submitBtn.disabled = false;
        }
      });
    });
  </script>
</body>
</html>
